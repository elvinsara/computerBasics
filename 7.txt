using System;
using Microsoft.SharePoint.Client;
using System.Security;

namespace SharePointListUpdater
{
    class Program
    {
        static void Main(string[] args)
        {
            // Gather user input
            Console.WriteLine("Enter SharePoint Site URL:");
            string siteUrl = Console.ReadLine();

            Console.WriteLine("Enter List Name:");
            string listName = Console.ReadLine();

            Console.WriteLine("Enter Item ID:");
            int itemId;
            while (!int.TryParse(Console.ReadLine(), out itemId))
            {
                Console.WriteLine("Invalid input. Please enter a valid Item ID:");
            }

            Console.WriteLine("Enter Updated Title:");
            string updatedTitle = Console.ReadLine();

            // Update the list item
            try
            {
                UpdateListItem(siteUrl, listName, itemId, updatedTitle);
                Console.WriteLine($"Item updated successfully: Task ID {itemId}");
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error: {ex.Message}");
            }
        }

        static void UpdateListItem(string siteUrl, string listName, int itemId, string updatedTitle)
        {
            // Credentials for authentication
            Console.WriteLine("Enter your username:");
            string username = Console.ReadLine();

            Console.WriteLine("Enter your password:");
            SecureString password = new SecureString();
            foreach (char c in Console.ReadLine())
            {
                password.AppendChar(c);
            }

            using (ClientContext context = new ClientContext(siteUrl))
            {
                context.Credentials = new SharePointOnlineCredentials(username, password);

                // Get the list
                List list = context.Web.Lists.GetByTitle(listName);
                context.Load(list);
                context.ExecuteQuery();

                // Get the item to update
                ListItem item = list.GetItemById(itemId);
                context.Load(item);
                context.ExecuteQuery();

                // Update the item
                item["Title"] = updatedTitle; // Assuming "Title" is the field to update
                item.Update();
                context.ExecuteQuery();
            }
        }
    }
}
